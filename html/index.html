<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>CELPA</title>
        <meta name="description" lang="en" content="The largest and most up-to-date repository of Emacs packages.">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link rel="shortcut icon" href="favicon.ico">
        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Melpa" >
        <link href="/updates.rss" rel="alternate" title="MELPA updates" type="application/rss+xml">
        <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <link href="https://netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="css/melpa.css" type="text/css">
    </head>
    <body>
        <header class="navbar navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a href="#/" class="navbar-brand archive-name">CELPA</a>
                </div>
                <nav class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="#/">Packages</a></li>
                        <li><a href="https://github.com/celpa/celpa">GitHub</a></li>
                    </ul>
                </nav>
            </div>
        </header>
        <main class="container" id="content">
            <h1><span class="archive-name">CELPA</span> (Conao3’s Emacs Lisp Package Archive)</h1>
            <ul>
                <li><strong>Up-to-date packages built on our servers from upstream source</strong></li>
                <li><strong>Installable in any Emacs with 'package.el'</strong> - no local version-control tools needed</li>
                <li><strong>Curated</strong> - no obsolete, renamed, forked or randomly hacked packages</li>
                <li><strong>Comprehensive</strong> - more packages than any other archive</li>
                <li><strong>Automatic updates</strong> - new commits result in new packages</li>
                <li><strong>Extensible</strong> - contribute recipes via github, and we'll build the packages</li>
            </ul>
            <section id="packages">
                <h2>Current List of 4,590 Packages</h2>
                <table id="package-list" class="table table-bordered table-responsive table-hover">
                    <thead>
                        <tr>
                            <th>Package</th>
                            <th>Description</th>
                            <th>Version</th>
                            <th>Recipe</th>
                            <th>Source</th>
                        </tr>
                    </thead>
                    <tbody id="main-table">
                        <tr>
                            <td>0blayout</td>
                            <td>Layout grouping with ease</td>
                            <td class="version"><a href="packages/0blayout-20190703.527.el">20190703.527 <span class="glyphicon glyphicon-download"></span></a></td>
                            <td class="recipe"><a href="https://github.com/melpa/melpa/blob/master/recipes/0blayout"><span class="glyphicon glyphicon-cutlery"></span></a></td>
                            <td class="source"><a href="https://github.com/etu/0blayout-mode/tree/fd9a8f353dbd45b4628b5f84b8d8c2525ebf571d">github</a></td>
                        </tr>
                        <tr>
                            <td>0x0</td>
                            <td>Upload to 0x0.st</td>
                            <td class="version"><a href="packages/0x0-20200411.1227.el">20200411.1227 <span class="glyphicon glyphicon-download"></span></a></td>
                            <td class="recipe"><a href="https://github.com/melpa/melpa/blob/master/recipes/0x0"><span class="glyphicon glyphicon-cutlery"></span></a></td>
                            <td class="source"><a href="https://git.sr.ht/~zge/nullpointer-emacs">git</a></td>
                        </tr>
                    </tbody>
                </table>
            </section>
        </main>
        <footer class="container">
            <small>
                <a href="https://github.com/conao3/celpa">Source code for this page &rarr;</a>
                <br/>
                <a href="jslicense.html" data-jslicense="1">JavaScript license information</a>
            </small>
        </footer>
    </body>
    <script>
     $.getJSON('/archive.json', function(data) {
         var items = [];
         $.each(data, function(key, val) {
             items.push('<li id="' + key + '">' + val + '</li>');
         });
         $('<ul/>', {
             'class': 'my-new-list',
             html: items.join('')
         }).appendTo('body');
         $('<ul/>', {
             'class': 'my-new-list',
             html: Object.keys(data)
         }).appendTo('body');
     });

     function search(query) {
         var result = searchData(query);
         var html = createHtml(result);
         showResult(html);
         showResultCount(result.length, data.length);
     }

     function searchData(query) {
         // [inx, beg, end]
         var result = [];

         query = query.trim();
         if (query.length < 1) {
             return result;
         }
         var re = new RegExp(query, 'i');
         for (var i = 0; i < data.length; ++i) {
             var pos = data[i].body.search(re);
             if (pos != -1) {
                 result.push([i, pos, pos + query.length]);
             }
         }
         return result;
     }

     function createHtml(result) {
         var htmls = [];
         for (var i = 0; i < result.length; ++i) {
             var dataIndex = result[i][0];
             var startPos = result[i][1];
             var endPos = result[i][2];
             var url = data[dataIndex].url;
             var title = data[dataIndex].title;
             var body = data[dataIndex].body;
             htmls.push(createEntry(url, title, body, startPos, endPos));
         }
         return htmls.join('');
     }

     function createEntry(url, title, body, startPos, endPos) {
         return '<ul class="article-listing-item">' +
                '<a class="article-listing-title" href="' + url + '">' + title + '</a>' +
                '<div class="article-listing-summary">' + excerpt(body, startPos, endPos) + '</div>' +
                '</ul>';
     }

     function excerpt(body, startPos, endPos) {
         return [
             body.substring(startPos - 30, startPos),
             '<span class="article-listing-strong">', body.substring(startPos, endPos), '</span>',
             body.substring(endPos, endPos + 200)
         ].join('');
     }

     function showResult(html) {
         var el = document.getElementById('result');
         el.innerHTML = html;
     }

     function showResultCount(count, total) {
         var el = document.getElementById('resultCount');
         el.innerHTML = 'Found <b>' + count + '</b> pages（in ' + total + ' pages）';
     }
    </script>
</html>
