<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>CELPA</title>
        <meta name="description" lang="en" content="The largest and most up-to-date repository of Emacs packages.">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link rel="shortcut icon" href="favicon.ico">
        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Melpa" >
        <link href="/updates.rss" rel="alternate" title="MELPA updates" type="application/rss+xml">
        <link href="https://netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="css/melpa.css" type="text/css">
    </head>
    <body>
        <header class="navbar navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a href="#/" class="navbar-brand archive-name">CELPA</a>
                </div>
                <nav class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="#/">Packages</a></li>
                        <li><a href="https://github.com/celpa/celpa">GitHub</a></li>
                    </ul>
                </nav>
            </div>
        </header>
        <main class="container" id="content">
            <h1><span class="archive-name">CELPA</span> (Conao3’s Emacs Lisp Package Archive)</h1>
            <ul>
                <li><strong>Up-to-date packages built on our servers from upstream source</strong></li>
                <li><strong>Installable in any Emacs with 'package.el'</strong> - no local version-control tools needed</li>
                <li><strong>Curated</strong> - no obsolete, renamed, forked or randomly hacked packages</li>
                <li><strong>Comprehensive</strong> - more packages than any other archive</li>
                <li><strong>Automatic updates</strong> - new commits result in new packages</li>
                <li><strong>Extensible</strong> - contribute recipes via github, and we'll build the packages</li>
            </ul>
            <p>This site requires JavaScript to function. You can browse and install packages directly from Emacs (<a href="https://github.com/conao3/celpa">see CELPA's README.md on GitHub</a>).</p>
            <form>
                <div id="search-form" class="form-group">
                    <input class="form-control" onkeyup="search(this.value)" autocomplete="off" autofocus placeholder="Search" />
                    <span id="inputWord"></span><span id="resultCount"></span>
                </div>
                <ul id="result" class="article-listing"><p>Please input query...</p></ul>
            </form>
        </main>
        <footer class="container">
            <small>
                <a href="https://github.com/conao3/celpa">Source code for this page &rarr;</a>
                <br/>
                <a href="jslicense.html" data-jslicense="1">JavaScript license information</a>
            </small>
        </footer>
    </body>
    <script>
     $.getJSON("/archive.json", function(json) {
         console.log(json); // this will show the info it in firebug console
     });
     function search(query) {
         var result = searchData(query);
         var html = createHtml(result);
         showResult(html);
         showResultCount(result.length, data.length);
     }

     function searchData(query) {
         // [inx, beg, end]
         var result = [];

         query = query.trim();
         if (query.length < 1) {
             return result;
         }
         var re = new RegExp(query, 'i');
         for (var i = 0; i < data.length; ++i) {
             var pos = data[i].body.search(re);
             if (pos != -1) {
                 result.push([i, pos, pos + query.length]);
             }
         }
         return result;
     }

     function createHtml(result) {
         var htmls = [];
         for (var i = 0; i < result.length; ++i) {
             var dataIndex = result[i][0];
             var startPos = result[i][1];
             var endPos = result[i][2];
             var url = data[dataIndex].url;
             var title = data[dataIndex].title;
             var body = data[dataIndex].body;
             htmls.push(createEntry(url, title, body, startPos, endPos));
         }
         return htmls.join('');
     }

     function createEntry(url, title, body, startPos, endPos) {
         return '<ul class="article-listing-item">' +
                '<a class="article-listing-title" href="' + url + '">' + title + '</a>' +
                '<div class="article-listing-summary">' + excerpt(body, startPos, endPos) + '</div>' +
                '</ul>';
     }

     function excerpt(body, startPos, endPos) {
         return [
             body.substring(startPos - 30, startPos),
             '<span class="article-listing-strong">', body.substring(startPos, endPos), '</span>',
             body.substring(endPos, endPos + 200)
         ].join('');
     }

     function showResult(html) {
         var el = document.getElementById('result');
         el.innerHTML = html;
     }

     function showResultCount(count, total) {
         var el = document.getElementById('resultCount');
         el.innerHTML = 'Found <b>' + count + '</b> pages（in ' + total + ' pages）';
     }
    </script>
</html>
